# ุฏููู ุฅูุบุงุก ุงูุชุญูู ูู ุงูุฅูููู ูู Supabase

## ุงูุชุบููุฑุงุช ุงูููุทุจูุฉ ูู ุงูููุฏ

### 1. ูู `lib/services/supabase_service.dart`
- โ ุฅุฒุงูุฉ `emailRedirectTo` ูู `signUp`
- โ ุชุนููู `email_verified: true` ูู `userProfileData`
- โ ุฅุฒุงูุฉ ุฅุฑุณุงู ุฑุณุงูุฉ ุงูุชุญูู
- โ ุฅุฒุงูุฉ ูุญุต `emailConfirmedAt` ูู ุชุณุฌูู ุงูุฏุฎูู
- โ ุฅุฒุงูุฉ ุฑุณุงุฆู ุงูุฎุทุฃ ุงููุชุนููุฉ ุจุงูุชุญูู ูู ุงูุฅูููู

### 2. ูู `lib/controllers/auth_controller.dart`
- โ ุชุบููุฑ ุงูุชููู ุจุนุฏ ุงูุชุณุฌูู ุฅูู `/home` ุจุฏูุงู ูู `/email-verification`
- โ ุฅุฒุงูุฉ ููุทู ุงูุชุญูู ูู ุงูุฅูููู ูู ุชุณุฌูู ุงูุฏุฎูู
- โ ุชุนุทูู ุฏูุงู `resendVerificationEmail` ู `checkEmailVerification`

## ุฅุนุฏุงุฏุงุช Supabase ุงููุทููุจุฉ

### 1. ูู Supabase Dashboard

#### Authentication Settings
1. ุงุฐูุจ ุฅูู **Authentication** > **Settings**
2. ูู ูุณู **Email Auth**:
   - โ ุชุฃูุฏ ูู ุฃู **Enable email confirmations** **ูุนุทู**
   - ุฃู ุงุถุจุท **Confirm email change** ุฅูู **Disabled**

#### Email Templates (ุงุฎุชูุงุฑู)
1. ุงุฐูุจ ุฅูู **Authentication** > **Email Templates**
2. ููููู ุชุนุทูู ุงูููุงูุจ ุงูุชุงููุฉ:
   - **Confirm signup** - ูุนุทู
   - **Magic Link** - ูุนุทู
   - **Change Email Address** - ูุนุทู

### 2. SQL Commands (ุงุฎุชูุงุฑู)

#### ุชุญุฏูุซ ุงููุณุชุฎุฏููู ุงูููุฌูุฏูู
```sql
-- ุชุญุฏูุซ ุฌููุน ุงููุณุชุฎุฏููู ููุตุจุญูุง ูุคูุฏูู
UPDATE auth.users 
SET email_confirmed_at = NOW() 
WHERE email_confirmed_at IS NULL;

-- ุชุญุฏูุซ user_profiles
UPDATE user_profiles 
SET email_verified = true 
WHERE email_verified = false;
```

#### ุฅุฒุงูุฉ ูููุฏ ุงูุชุญูู ูู ุงูุฅูููู
```sql
-- ุฅุฐุง ูุงู ูุฏูู ุณูุงุณุงุช RLS ุชุนุชูุฏ ุนูู ุงูุชุญูู ูู ุงูุฅูููู
-- ูู ุจุชุญุฏูุซูุง ูุชุชุฌุงูู email_verified

-- ูุซุงู: ุชุญุฏูุซ ุณูุงุณุฉ ุงููุฑุงุกุฉ
DROP POLICY IF EXISTS "Users can read own profile" ON user_profiles;
CREATE POLICY "Users can read own profile" ON user_profiles
  FOR SELECT USING (auth.uid() = id);
```

### 3. Environment Variables (ุงุฎุชูุงุฑู)

ุฅุฐุง ููุช ุชุณุชุฎุฏู ูุชุบูุฑุงุช ุงูุจูุฆุฉ:
```env
# ูู ููู .env
SUPABASE_DISABLE_EMAIL_CONFIRMATION=true
```

## ุงุฎุชุจุงุฑ ุงูุชุบููุฑุงุช

### 1. ุงุฎุชุจุงุฑ ุงูุชุณุฌูู
```bash
# ุฌุฑุจ ุชุณุฌูู ูุณุชุฎุฏู ุฌุฏูุฏ
# ูุฌุจ ุฃู ูุชู ุชุณุฌูู ุงูุฏุฎูู ูุจุงุดุฑุฉ ุฅูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
```

### 2. ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู
```bash
# ุฌุฑุจ ุชุณุฌูู ุงูุฏุฎูู ุจุญุณุงุจ ููุฌูุฏ
# ูุฌุจ ุฃู ูุนูู ุจุฏูู ูุดุงูู
```

### 3. ุงุฎุชุจุงุฑ ุงูุชุญูู ูู ุงูุฅูููู
```bash
# ูุฌุจ ุฃู ุชุนูุฏ ุงูุฏูุงู ุฑุณุงูุฉ "Email verification is not required"
```

## ููุงุญุธุงุช ูููุฉ

### โ ุงููุฒุงูุง
- ุชุณุฌูู ุณุฑูุน ูุณูู
- ูุง ุญุงุฌุฉ ูุงูุชุธุงุฑ ุงูุฅูููู
- ุชุฌุฑุจุฉ ูุณุชุฎุฏู ูุญุณูุฉ
- ุชูููู ุงูุชุนููุฏ

### โ๏ธ ุงูุชุญุฐูุฑุงุช
- **ุงูุฃูุงู**: ุงูุชุญูู ูู ุงูุฅูููู ูููุฑ ุทุจูุฉ ุฅุถุงููุฉ ูู ุงูุฃูุงู
- **ุงูุจูุงูุงุช ุงููุฒููุฉ**: ูููู ุฅูุดุงุก ุญุณุงุจุงุช ุจุฅููููุงุช ูุฒููุฉ
- **ุงูุงูุชุซุงู**: ูุฏ ุชุญุชุงุฌ ุงูุชุญูู ูู ุงูุฅูููู ููุงูุชุซุงู ููููุงููู

### ๐ง ุงูุญููู ุงูุจุฏููุฉ
1. **ุงูุชุญูู ูู ุฑูู ุงููุงุชู**: ุจุฏูุงู ูู ุงูุฅูููู
2. **ุงูุชุญูู ุงููุฏูู**: ูููุณุชุฎุฏููู ุงูุฌุฏุฏ
3. **ูุธุงู ุงูููุงุท**: ููุชุญูู ูู ุตุญุฉ ุงููุณุชุฎุฏููู
4. **ุงูุชุญูู ุงูุงุฌุชูุงุนู**: ุนุจุฑ Google/Facebook

## ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฅุฐุง ูู ูุนูู ุงูุชุณุฌูู
```bash
# ุชุญูู ูู ุฅุนุฏุงุฏุงุช Authentication ูู Supabase
# ุชุฃูุฏ ูู ุฃู Email confirmations ูุนุทู
```

### ุฅุฐุง ุธูุฑุช ุฑุณุงุฆู ุฎุทุฃ
```bash
# ุชุญูู ูู ุงูููุฏ ุงููุญุฏุซ
# ุชุฃูุฏ ูู ุฃู ุฌููุน ุงููุฑุงุฌุน ููุชุญูู ูู ุงูุฅูููู ุชู ุฅุฒุงูุชูุง
```

### ุฅุฐุง ูู ูุนูู ุชุณุฌูู ุงูุฏุฎูู
```bash
# ุชุญูู ูู ุฃู email_verified = true ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
# ุชุฃูุฏ ูู ุฅุฒุงูุฉ ูุญุต emailConfirmedAt
```

## ุงูุชุญุฏูุซุงุช ุงููุณุชูุจููุฉ

### ุฅุฐุง ุฃุฑุฏุช ุฅุนุงุฏุฉ ุชูุนูู ุงูุชุญูู ูู ุงูุฅูููู
1. ุนูุณ ุงูุชุบููุฑุงุช ูู ุงูููุฏ
2. ุชูุนูู **Enable email confirmations** ูู Supabase
3. ุชุญุฏูุซ `email_verified` ุฅูู `false` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
4. ุฅุฑุณุงู ุฑุณุงุฆู ุชุญูู ูููุณุชุฎุฏููู ุงูููุฌูุฏูู

### ุฅุถุงูุฉ ุงูุชุญูู ูู ุฑูู ุงููุงุชู
```dart
// ูู SupabaseService
Future<Map<String, dynamic>> sendPhoneVerification(String phone) async {
  await client.auth.signInWithOtp(phone: phone);
}

Future<Map<String, dynamic>> verifyPhone(String phone, String token) async {
  final response = await client.auth.verifyOTP(
    phone: phone,
    token: token,
    type: OtpType.sms,
  );
  return {'success': response.user != null};
}
```

---

## ุงูุฎูุงุตุฉ

ุชู ุฅูุบุงุก ุงูุชุญูู ูู ุงูุฅูููู ุจูุฌุงุญ. ุงูุขู:

1. **ุงูุชุณุฌูู**: ูุคุฏู ูุจุงุดุฑุฉ ุฅูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
2. **ุชุณุฌูู ุงูุฏุฎูู**: ูุนูู ุจุฏูู ูุญุต ุงูุชุญูู ูู ุงูุฅูููู
3. **ุงูุจูุงูุงุช**: `email_verified` ููุนููู ุชููุงุฆูุงู ุฅูู `true`
4. **ุงูุฏูุงู**: ุฌููุน ุฏูุงู ุงูุชุญูู ูู ุงูุฅูููู ูุนุทูุฉ

ุชุฃูุฏ ูู ุชุญุฏูุซ ุฅุนุฏุงุฏุงุช Supabase ูุชุชูุงุดู ูุน ูุฐู ุงูุชุบููุฑุงุช.
