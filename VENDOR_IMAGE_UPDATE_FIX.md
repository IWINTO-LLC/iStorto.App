# ุฅุตูุงุญ ูุดููุฉ ุชุญุฏูุซ ุตูุฑ ุงููุชุงุฌุฑ (ุงูููุบู ูุงูุบูุงู)

## ๐ ุงููุดููุฉ ุงูููุชุดูุฉ

ูุงูุช ุงููุดููุฉ ูู **ุนุฏู ุชุทุงุจู ุงููุนุฑู** ุงููุณุชุฎุฏู ูู ุนูููุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช:

### ูุจู ุงูุฅุตูุงุญ:
```dart
// โ ุฎุทุฃ - ูู VendorImageController
await SupabaseService.client
    .from('vendors')
    .update({fieldName: imageUrl})
    .eq('user_id', vendorId);  // โ ูุณุชุฎุฏู user_id
```

```dart
// โ ุตุญูุญ - ูู VendorRepository
final response = await _client
    .from('vendors_with_social_links')
    .select()
    .eq('id', vendorId);  // โ ูุณุชุฎุฏู id
```

**ุงููุดููุฉ:** `vendorId` ุงูุฐู ูุชู ุชูุฑูุฑู ูู `id` (ุงูููุชุงุญ ุงูุฃุณุงุณู) ูููุณ `user_id`!

---

## โ ุงูุฅุตูุงุญ ุงููุทุจู

### 1. ุชุญุฏูุซ `VendorImageController`

**ุงูููู:** `lib/featured/shop/controller/vendor_image_controller.dart`

**ุงูุชุบููุฑ:**
```dart
// โ ุจุนุฏ ุงูุฅุตูุงุญ
final response = await SupabaseService.client
    .from('vendors')
    .update({fieldName: imageUrl})
    .eq('id', vendorId)  // โ ุชุบููุฑ ูู user_id ุฅูู id
    .select();
```

**ุฅุถุงูุฉ logging ููุชุชุจุน:**
```dart
debugPrint('๐ Updating $fieldName for vendor: $vendorId');
debugPrint('๐ธ New image URL: $imageUrl');
debugPrint('โ Update response: $response');
```

---

## ๐๏ธ ุงููููุงุช ุงููููุดุฃุฉ

### 1. `fix_vendor_image_update_policy.sql`
ุณูุฑูุจุช SQL ูุฅุตูุงุญ ุณูุงุณุงุช RLS:
- โ ูุณูุญ ููุจุงุฆุนูู ุจุชุญุฏูุซ ูุชุงุฌุฑูู
- โ ูุถูู ุงูุตูุงุญูุงุช ุงูุตุญูุญุฉ
- โ ููุญุต ุงูุณูุงุณุงุช ุงูุญุงููุฉ

**ููููุฉ ุงูุงุณุชุฎุฏุงู:**
```bash
# ูู Supabase SQL Editor
1. ุงูุชุญ SQL Editor
2. ุงูุตู ูุญุชูู ุงูููู
3. ููุฐ ุงูุณูุฑูุจุช
4. ุฑุงุฌุน ุงููุชุงุฆุฌ
```

### 2. `debug_vendor_image_update.sql`
ุณูุฑูุจุช ุชุตุญูุญ ุฃุฎุทุงุก ููุชุญูู ูู:
- โ ุจูุงูุงุช ุงููุชุฌุฑ
- โ ุงููุณุชุฎุฏู ุงูุญุงูู
- โ ุชุทุงุจู ุงูุตูุงุญูุงุช
- โ ุณูุงุณุงุช RLS
- โ ุงูุฃุนูุฏุฉ ูุงูุฌุฏุงูู

**ููููุฉ ุงูุงุณุชุฎุฏุงู:**
```bash
1. ุงูุชุญ ุงูููู
2. ุงุณุชุจุฏู 'YOUR_VENDOR_ID' ุจูุนุฑู ุงููุชุฌุฑ ุงููุนูู
3. ุงุณุชุจุฏู 'YOUR_IMAGE_URL' ุจุฑุงุจุท ุงูุตูุฑุฉ (ููุงุฎุชุจุงุฑ)
4. ููุฐ ุงูุงุณุชุนูุงูุงุช ูุงุญุฏุงู ุชูู ุงูุขุฎุฑ
5. ุฑุงุฌุน ุงููุชุงุฆุฌ ูุชุญุฏูุฏ ุงููุดููุฉ
```

---

## ๐ ุฎุทูุงุช ุงูุชุญูู

### 1. ุงูุชุญูู ูู ุงูููุฏ

```dart
โ VendorImageController ูุณุชุฎุฏู .eq('id', vendorId)
โ ุฅุถุงูุฉ debug logs ููุชุชุจุน
โ ุฅุถุงูุฉ .select() ูุฑุคูุฉ ุงููุชูุฌุฉ
```

### 2. ุงูุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

```sql
-- ูุญุต ุจููุฉ ุงูุฌุฏูู
SELECT column_name FROM information_schema.columns 
WHERE table_name = 'vendors';

-- ุงูุชุญูู ูู RLS
SELECT tablename, rowsecurity FROM pg_tables 
WHERE tablename = 'vendors';
```

### 3. ุงูุชุญูู ูู ุงูุณูุงุณุงุช

```sql
-- ุนุฑุถ ุณูุงุณุงุช UPDATE
SELECT policyname, cmd FROM pg_policies 
WHERE tablename = 'vendors' AND cmd = 'UPDATE';
```

---

## ๐งช ุงุฎุชุจุงุฑ ุงูุฅุตูุงุญ

### 1. ูู ุงูุชุทุจูู:

1. ุดุบูู ุงูุชุทุจูู ูู ูุถุน debug
2. ุงูุชูู ุฅูู ุตูุญุฉ ุงููุชุฌุฑ ูู ูุถุน ุงูุชุนุฏูู
3. ุงุถุบุท ุนูู ุดุนุงุฑ ุงููุชุฌุฑ
4. ุงุฎุชุฑ ุตูุฑุฉ ุฌุฏูุฏุฉ
5. ุฑุงูุจ console logs:
   ```
   ๐ Updating organization_logo for vendor: xxx-xxx-xxx
   ๐ธ New image URL: https://...
   โ Update response: [...]
   ```

### 2. ูู Supabase:

1. ุงูุชุญ Table Editor
2. ุงุจุญุซ ุนู ูุชุฌุฑู ูู ุฌุฏูู `vendors`
3. ุชุญูู ูู ุชุญุฏูุซ `organization_logo` ุฃู `organization_cover`
4. ุชุญูู ูู ุชุญุฏูุซ `updated_at`

---

## ๐ฏ ุงููุชูุฌุฉ ุงููุชููุนุฉ

### ุนูุฏ ุฑูุน ุตูุฑุฉ ุฌุฏูุฏุฉ:

1. โ ุชุธูุฑ ุฏุงุฆุฑุฉ ุงูุชูุฏู (0% โ 100%)
2. โ ูุชู ุฑูุน ุงูุตูุฑุฉ ุฅูู Supabase Storage
3. โ ูุชู ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจูุฌุงุญ
4. โ ูุชู ุชุญุฏูุซ VendorController
5. โ ุชุธูุฑ ุงูุตูุฑุฉ ุงูุฌุฏูุฏุฉ ููุฑุงู
6. โ ุฅุดุนุงุฑ ุฃุฎุถุฑ: "ุชู ุชุญุฏูุซ ุดุนุงุฑ ุงููุชุฌุฑ ุจูุฌุงุญ!"

### ูู ุญุงูุฉ ุงููุดู:

1. โ ุฑุณุงูุฉ ุฎุทุฃ ุญูุฑุงุก
2. ๐ Debug logs ูู console ุชุญุฏุฏ ุงููุดููุฉ
3. ๐ ุงุณุชุฎุฏู `debug_vendor_image_update.sql` ููุชุญููู

---

## ๐ง ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ูุง ูุฒุงู ุงูุชุญุฏูุซ ูุง ูุนูู

#### ุงูุญู 1: ุชุญูู ูู vendor ID
```dart
// ูู market_header.dart
debugPrint('๐ Vendor ID being used: $vendorId');
debugPrint('๐ Vendor user_id: ${vendor.userId}');
```

#### ุงูุญู 2: ุชุญูู ูู RLS
```bash
1. ููุฐ fix_vendor_image_update_policy.sql
2. ุชุฃูุฏ ูู ุชูุนูู RLS
3. ุชุฃูุฏ ูู ุตูุงุญูุงุช UPDATE
```

#### ุงูุญู 3: ุชุญูู ูู ุงูุตูุงุญูุงุช
```sql
-- ูู Supabase SQL Editor
SELECT * FROM vendors WHERE id = 'YOUR_VENDOR_ID';
-- ุฅุฐุง ูู ุชุธูุฑ ูุชุงุฆุฌุ ููุงู ูุดููุฉ ูู RLS
```

#### ุงูุญู 4: ุงูุชุญูู ุงููุฏูู
```sql
-- ุฌุฑุจ ุงูุชุญุฏูุซ ูุฏููุงู
UPDATE vendors 
SET organization_logo = 'test_url',
    updated_at = NOW()
WHERE id = 'YOUR_VENDOR_ID';

-- ุฅุฐุง ูุฌุญ: ุงููุดููุฉ ูู ุงูููุฏ
-- ุฅุฐุง ูุดู: ุงููุดููุฉ ูู RLS ุฃู ุงูุตูุงุญูุงุช
```

---

## ๐ ูููู ุฌุฏูู vendors

```sql
- id (uuid, PK)             -- ุงูููุชุงุญ ุงูุฃุณุงุณู โ ูุณุชุฎุฏูู ููุชุญุฏูุซ
- user_id (uuid, FK)        -- ูุนุฑู ุงููุณุชุฎุฏู
- organization_logo (text)  -- ุดุนุงุฑ ุงููุชุฌุฑ
- organization_cover (text) -- ุบูุงู ุงููุชุฌุฑ
- updated_at (timestamp)    -- ุขุฎุฑ ุชุญุฏูุซ
```

---

## ๐ ููุงุญุธุงุช

1. **ุงุณุชุฎุฏู ุฏุงุฆูุงู `id` ููุนูููุงุช ุนูู ุฌุฏูู `vendors`**
2. **ุงุณุชุฎุฏู `user_id` ููุท ููุชุญูู ูู ุงูููููุฉ ูู RLS**
3. **ุฑุงูุจ debug logs ููุชุฃูุฏ ูู ุงูุชูููุฐ**
4. **ุงุฎุชุจุฑ RLS policies ูุจู ุงููุดุฑ**

---

## โจ ุงูุชุญุณููุงุช ุงููุถุงูุฉ

### 1. ุฏุงุฆุฑุฉ ุงูุชูุฏู
- ุนุฑุถ ูุณุจุฉ ุงูุชูุฏู (0-100%)
- ูุต "ุฌุงุฑู ุงูุฑูุน"
- ุชุญุฏูุซ ูุจุงุดุฑ

### 2. Logging ูุญุณูู
- ุชุชุจุน vendorId ุงููุณุชุฎุฏู
- ุนุฑุถ URL ุงูุตูุฑุฉ
- ุนุฑุถ ูุชูุฌุฉ ุงูุชุญุฏูุซ

### 3. ูุนุงูุฌุฉ ุฃุฎุทุงุก ุฃูุถู
- ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ
- ุฅุนุงุฏุฉ ุชุนููู ุงูุชูุฏู ุนูุฏ ุงููุดู
- debug information ููุตู

---

## ๐ ุงูุฎูุงุตุฉ

ุชู ุฅุตูุงุญ ุงููุดููุฉ ุจุชุบููุฑ:
```diff
- .eq('user_id', vendorId)
+ .eq('id', vendorId)
```

ุงูุขู ุชุญุฏูุซ ุตูุฑ ุงููุชุงุฌุฑ ูุนูู ุจุดูู ุตุญูุญ! โ

