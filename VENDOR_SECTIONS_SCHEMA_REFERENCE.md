# ูุฑุฌุน ูููู ุฌุฏูู ุงูุฃูุณุงู ๐
# Vendor Sections Schema Reference

## ููุงุฑูุฉ ุจูู ุงููุณุฎุฉ ุงููุฏููุฉ ูุงูุฌุฏูุฏุฉ

---

## ุงููุณุฎุฉ ุงูุฌุฏูุฏุฉ (ุงูุญุงููุฉ) - 17 ุญูู โจ

### ุงูุฌุฏูู ุงููุงูู: `vendor_sections`

| # | Column Name | Type | Nullable | Default | Description |
|---|-------------|------|----------|---------|-------------|
| 1 | `id` | UUID | NO | gen_random_uuid() | ุงููุนุฑู ุงููุฑูุฏ |
| 2 | `vendor_id` | UUID | NO | - | ูุนุฑู ุงูุชุงุฌุฑ (FK) |
| 3 | `section_key` | TEXT | NO | - | ุงูููุชุงุญ ุงูุฏุงุฎูู |
| 4 | `display_name` | TEXT | NO | - | ุงูุงุณู ุจุงูุฅูุฌููุฒูุฉ |
| 5 | `arabic_name` | TEXT | YES | NULL | ุงูุงุณู ุจุงูุนุฑุจูุฉ โจ ุฌุฏูุฏ |
| 6 | `display_type` | TEXT | YES | 'grid' | ููุน ุงูุนุฑุถ โจ ุฌุฏูุฏ |
| 7 | `card_width` | DOUBLE | YES | NULL | ุนุฑุถ ุงูุจุทุงูุฉ โจ ุฌุฏูุฏ |
| 8 | `card_height` | DOUBLE | YES | NULL | ุงุฑุชูุงุน ุงูุจุทุงูุฉ โจ ุฌุฏูุฏ |
| 9 | `items_per_row` | INTEGER | YES | 3 | ุนุฏุฏ ุงูุนูุงุตุฑ/ุตู โจ ุฌุฏูุฏ |
| 10 | `is_active` | BOOLEAN | YES | TRUE | ููุนููุ โจ ุฌุฏูุฏ |
| 11 | `is_visible_to_customers` | BOOLEAN | YES | TRUE | ูุฑุฆู ููุฒุจุงุฆูุ โจ ุฌุฏูุฏ |
| 12 | `sort_order` | INTEGER | YES | 0 | ุงูุชุฑุชูุจ โจ ุฌุฏูุฏ |
| 13 | `icon_name` | TEXT | YES | NULL | ุงุณู ุงูุฃููููุฉ โจ ุฌุฏูุฏ |
| 14 | `color_hex` | TEXT | YES | NULL | ููู ุงููุณู โจ ุฌุฏูุฏ |
| 15 | `created_at` | TIMESTAMP | YES | NOW() | ุชุงุฑูุฎ ุงูุฅูุดุงุก |
| 16 | `updated_at` | TIMESTAMP | YES | NOW() | ุชุงุฑูุฎ ุงูุชุญุฏูุซ |
| 17 | UNIQUE | - | - | - | (vendor_id, section_key) |

---

## ุงููุณุฎุฉ ุงููุฏููุฉ (ุงููุจุฏุฆูุฉ) - 6 ุญููู ููุท

```sql
-- ูุงูุช ููุท:
id
vendor_id
name (section_key)
english_name (display_name)
created_at
updated_at
```

---

## ุงูุญููู ุงูุฌุฏูุฏุฉ ุงููุถุงูุฉ (11 ุญูู ุฌุฏูุฏ) โจ

### 1. **arabic_name** (TEXT)
- ุงูุงุณู ุงููุนุฑูุถ ุจุงูุนุฑุจูุฉ
- ุงุฎุชูุงุฑู
- ูุซุงู: `'ุงูุนุฑูุถ'`, `'ุงูุชุฎููุถุงุช'`

### 2. **display_type** (TEXT)
- ููุน ุทุฑููุฉ ุงูุนุฑุถ
- ุงูููู ุงููุณููุญุฉ: `'grid'`, `'list'`, `'slider'`, `'carousel'`, `'custom'`
- ุงูุชุฑุงุถู: `'grid'`

### 3. **card_width** (DOUBLE PRECISION)
- ุนุฑุถ ุงูุจุทุงูุฉ
- ุงุฎุชูุงุฑู
- ูููู ุฃู ูููู ุจุงูุจูุณู ุฃู ุงููุณุจุฉ (25.w ูู Flutter)

### 4. **card_height** (DOUBLE PRECISION)
- ุงุฑุชูุงุน ุงูุจุทุงูุฉ
- ุงุฎุชูุงุฑู
- ุบุงูุจุงู ูุชู ุญุณุงุจู ุจูุณุจุฉ ูู card_width

### 5. **items_per_row** (INTEGER)
- ุนุฏุฏ ุงูุนูุงุตุฑ ูู ุงูุตู ุงููุงุญุฏ
- ุงูุชุฑุงุถู: `3`
- ูุซุงู: `1` ููู slider, `3` ุฃู `4` ููู grid

### 6. **is_active** (BOOLEAN)
- ูู ุงููุณู ููุนููุ
- ุงูุชุฑุงุถู: `TRUE`
- ุฅุฐุง ูุงู `FALSE`ุ ุงููุณู ูุนุทู ุชูุงูุงู

### 7. **is_visible_to_customers** (BOOLEAN)
- ูู ูุธูุฑ ููุฒุจุงุฆูุ
- ุงูุชุฑุงุถู: `TRUE`
- ูุณูุญ ููุชุงุฌุฑ ุจุฅุฎูุงุก ุฃูุณุงู ูุคูุชุงู

### 8. **sort_order** (INTEGER)
- ุชุฑุชูุจ ุงูุนุฑุถ ูู ุตูุญุฉ ุงููุชุฌุฑ
- ุงูุชุฑุงุถู: `0`
- ูููุง ูุงูุช ุงููููุฉ ุฃุตุบุฑุ ุธูุฑ ุงููุณู ุฃููุงู

### 9. **icon_name** (TEXT)
- ุงุณู ุงูุฃููููุฉ
- ุงุฎุชูุงุฑู
- ูุซุงู: `'flash_sale'`, `'star'`, `'trending_up'`

### 10. **color_hex** (TEXT)
- ููู ุงููุณู ุจุตูุบุฉ HEX
- ุงุฎุชูุงุฑู
- ูุซุงู: `'#FF5722'`, `'#4CAF50'`

### 11. **CHECK Constraint ุนูู display_type**
- ูุถูู ุฃู `display_type` ูููู ูุงุญุฏ ูู ุงูููู ุงููุณููุญุฉ ููุท

---

## ุฃูุซูุฉ ุงูุจูุงูุงุช

### ูุซุงู 1: ูุณู ุงูุนุฑูุถ
```sql
{
  "id": "uuid",
  "vendor_id": "vendor-uuid",
  "section_key": "offers",
  "display_name": "Offers",
  "arabic_name": "ุงูุนุฑูุถ",
  "display_type": "grid",
  "card_width": null,
  "card_height": null,
  "items_per_row": 4,
  "is_active": true,
  "is_visible_to_customers": true,
  "sort_order": 1,
  "icon_name": "local_offer",
  "color_hex": "#FF5722",
  "created_at": "2024-01-01T00:00:00Z",
  "updated_at": "2024-01-01T00:00:00Z"
}
```

### ูุซุงู 2: ูุณู ุงูุชุฎููุถุงุช (Slider)
```sql
{
  "id": "uuid",
  "vendor_id": "vendor-uuid",
  "section_key": "sales",
  "display_name": "Sales",
  "arabic_name": "ุงูุชุฎููุถุงุช",
  "display_type": "slider",
  "card_width": 94.0,  -- ุนุฑุถ ูุงูู
  "card_height": 125.0,  -- ูุณุจุฉ 8:6
  "items_per_row": 1,  -- ุนูุตุฑ ูุงุญุฏ ูู ุงููุฑุฉ
  "is_active": true,
  "is_visible_to_customers": true,
  "sort_order": 3,
  "icon_name": "trending_down",
  "color_hex": "#4CAF50",
  "created_at": "2024-01-01T00:00:00Z",
  "updated_at": "2024-01-01T00:00:00Z"
}
```

---

## Indexes (6 ูุคุดุฑุงุช)

1. **idx_vendor_sections_vendor_id**
   - ุนูู `vendor_id`
   - ุงูุฃูุซุฑ ุงุณุชุฎุฏุงูุงู

2. **idx_vendor_sections_section_key**
   - ุนูู `section_key`
   - ููุจุญุซ ุงูุณุฑูุน

3. **idx_vendor_sections_active**
   - ุนูู `(vendor_id, is_active)`
   - ูุฑูุจ ููุชุตููุฉ

4. **idx_vendor_sections_sort_order**
   - ุนูู `(vendor_id, sort_order)`
   - ููุชุฑุชูุจ ุงูุณุฑูุน

5. **idx_vendor_sections_visible**
   - ุนูู `(vendor_id, is_visible_to_customers)`
   - ููุนุฑุถ ููุฒุจุงุฆู

6. **idx_vendor_sections_display_type**
   - ุนูู `display_type`
   - ููุชุตููุฉ ุญุณุจ ููุน ุงูุนุฑุถ

---

## Functions (3 ุฏูุงู)

### 1. `update_vendor_sections_updated_at()`
- **ุงูููุน:** Trigger Function
- **ุงููุธููุฉ:** ุชุญุฏูุซ `updated_at` ุชููุงุฆูุงู ุนูุฏ ุงูุชุนุฏูู
- **ุงูุงุณุชุฎุฏุงู:** ุชููุงุฆู ุนุจุฑ Trigger

### 2. `create_default_vendor_sections(p_vendor_id UUID)`
- **ุงูููุน:** Stored Procedure
- **ุงููุธููุฉ:** ุฅูุดุงุก 12 ูุณู ุงูุชุฑุงุถู ูุชุงุฌุฑ ูุนูู
- **ุงูุงุณุชุฎุฏุงู ุงููุฏูู:**
  ```sql
  SELECT create_default_vendor_sections('vendor-uuid');
  ```
- **ุงูุงุณุชุฎุฏุงู ูู Dart:**
  ```dart
  await sectorRepository.createDefaultSections(vendorId);
  ```

### 3. `auto_create_vendor_sections()`
- **ุงูููุน:** Trigger Function
- **ุงููุธููุฉ:** ูุชู ุชุดุบูููุง ุชููุงุฆูุงู ุนูุฏ ุฅูุดุงุก ุชุงุฌุฑ ุฌุฏูุฏ
- **ุงูุงุณุชุฎุฏุงู:** ุชููุงุฆู ุนุจุฑ Trigger

---

## Triggers (2 ูุญูุฒุงุช)

### 1. `trigger_update_vendor_sections_updated_at`
- **ุนูู:** `vendor_sections`
- **ูุชู:** BEFORE UPDATE
- **ุงููุธููุฉ:** ุชุญุฏูุซ `updated_at`

### 2. `trigger_auto_create_vendor_sections`
- **ุนูู:** `vendors`
- **ูุชู:** AFTER INSERT
- **ุงููุธููุฉ:** ุฅูุดุงุก ุงูุฃูุณุงู ุงูุงูุชุฑุงุถูุฉ ุชููุงุฆูุงู ููุชุงุฌุฑ ุงูุฌุฏูุฏ

---

## RLS Policies (5 ุณูุงุณุงุช ุฃูุงู)

### 1. **Anyone can view active sections**
- **ุงูุนูููุฉ:** SELECT
- **ุงูุดุฑุท:** `is_active = true AND is_visible_to_customers = true`
- **ูู:** ุงูุฌููุน (anon + authenticated)

### 2. **Vendors can view their own sections**
- **ุงูุนูููุฉ:** SELECT
- **ุงูุดุฑุท:** `vendor_id IN (SELECT id FROM vendors WHERE user_id = auth.uid())`
- **ูู:** ุงูุชุฌุงุฑ ุงููุตุงุฏููู ููุท

### 3. **Vendors can create their own sections**
- **ุงูุนูููุฉ:** INSERT
- **ุงูุดุฑุท:** ุชุญูู ูู ููููุฉ ุงูุชุงุฌุฑ
- **ูู:** ุงูุชุฌุงุฑ ุงููุตุงุฏููู ููุท

### 4. **Vendors can update their own sections**
- **ุงูุนูููุฉ:** UPDATE
- **ุงูุดุฑุท:** ุชุญูู ูู ููููุฉ ุงูุชุงุฌุฑ (USING ู WITH CHECK)
- **ูู:** ุงูุชุฌุงุฑ ุงููุตุงุฏููู ููุท

### 5. **Vendors can delete their own sections**
- **ุงูุนูููุฉ:** DELETE
- **ุงูุดุฑุท:** ุชุญูู ูู ููููุฉ ุงูุชุงุฌุฑ
- **ูู:** ุงูุชุฌุงุฑ ุงููุตุงุฏููู ููุท

---

## ุฃููุงุน ุงูุนุฑุถ ุงููุชุงุญุฉ

| Display Type | Description | items_per_row | ุงูุงุณุชุฎุฏุงู |
|--------------|-------------|---------------|-----------|
| **grid** | ุดุจูุฉ ุนุงุฏูุฉ | 2-4 | ุงูุฃูุซุฑ ุดููุนุงู |
| **list** | ูุงุฆูุฉ ุนููุฏูุฉ | 1 | ููุชูุงุตูู ุงููุงููุฉ |
| **slider** | ุนุฑุถ ูุชุญุฑู ุฃููู | 1 | ููุตูุฑ ุงููุจูุฑุฉ |
| **carousel** | ุฏููุงุฑ ุชููุงุฆู | 1 | ููุนุฑูุถ ุงูุจุงุฑุฒุฉ |
| **custom** | ุชุฎุตูุต ุฎุงุต | ูุชุบูุฑ | ุญุณุจ ุงูุญุงุฌุฉ |

---

## ุงุณุชุนูุงูุงุช ูููุฏุฉ

### 1. ุนุฑุถ ุฌููุน ุฃูุณุงู ุชุงุฌุฑ:
```sql
SELECT * FROM vendor_sections 
WHERE vendor_id = 'vendor-uuid'
ORDER BY sort_order;
```

### 2. ุนุฑุถ ุงูุฃูุณุงู ุงููุดุทุฉ ููุท:
```sql
SELECT * FROM vendor_sections 
WHERE vendor_id = 'vendor-uuid'
  AND is_active = true
  AND is_visible_to_customers = true
ORDER BY sort_order;
```

### 3. ุชุญุฏูุซ ุงุณู ูุณู:
```sql
UPDATE vendor_sections 
SET display_name = 'Hot Deals',
    arabic_name = 'ุตููุงุช ุณุงุฎูุฉ'
WHERE id = 'section-uuid';
```

### 4. ุชุบููุฑ ููุน ุงูุนุฑุถ:
```sql
UPDATE vendor_sections 
SET display_type = 'slider',
    items_per_row = 1,
    card_width = 94.0,
    card_height = 125.0
WHERE id = 'section-uuid';
```

### 5. ุฅุฎูุงุก ูุณู ุนู ุงูุฒุจุงุฆู:
```sql
UPDATE vendor_sections 
SET is_visible_to_customers = false
WHERE id = 'section-uuid';
```

### 6. ุฅุนุงุฏุฉ ุชุฑุชูุจ ุงูุฃูุณุงู:
```sql
-- ููู ูุณู ููููุถุน ุงูุฃูู
UPDATE vendor_sections 
SET sort_order = 0
WHERE id = 'section-uuid';

-- ุชุญุฏูุซ ุจุงูู ุงูุฃูุณุงู
UPDATE vendor_sections 
SET sort_order = sort_order + 1
WHERE vendor_id = 'vendor-uuid'
  AND id != 'section-uuid';
```

---

## ุงูุชูุงูู ูุน Flutter/Dart

### SectorModel (17 ุญูู)
```dart
class SectorModel {
  String? id;
  String vendorId;
  String name;  // section_key
  String englishName;  // display_name
  String? arabicName;  // โ ุฌุฏูุฏ
  String displayType;  // โ ุฌุฏูุฏ
  double? cardWidth;  // โ ุฌุฏูุฏ
  double? cardHeight;  // โ ุฌุฏูุฏ
  int itemsPerRow;  // โ ุฌุฏูุฏ
  bool isActive;  // โ ุฌุฏูุฏ
  bool isVisibleToCustomers;  // โ ุฌุฏูุฏ
  int sortOrder;  // โ ุฌุฏูุฏ
  String? iconName;  // โ ุฌุฏูุฏ
  String? colorHex;  // โ ุฌุฏูุฏ
  DateTime? createdAt;
  DateTime? updatedAt;
}
```

### ุงูุชุญููู ูู/ุฅูู JSON
```dart
// ูู JSON
factory SectorModel.fromJson(Map<String, dynamic> json) {
  return SectorModel(
    id: json['id'],
    vendorId: json['vendor_id'],
    name: json['section_key'],
    englishName: json['display_name'],
    arabicName: json['arabic_name'],
    displayType: json['display_type'] ?? 'grid',
    cardWidth: json['card_width']?.toDouble(),
    cardHeight: json['card_height']?.toDouble(),
    itemsPerRow: json['items_per_row'] ?? 3,
    isActive: json['is_active'] ?? true,
    isVisibleToCustomers: json['is_visible_to_customers'] ?? true,
    sortOrder: json['sort_order'] ?? 0,
    iconName: json['icon_name'],
    colorHex: json['color_hex'],
    createdAt: json['created_at'] != null 
        ? DateTime.parse(json['created_at']) 
        : null,
    updatedAt: json['updated_at'] != null 
        ? DateTime.parse(json['updated_at']) 
        : null,
  );
}

// ุฅูู JSON
Map<String, dynamic> toJson() {
  return {
    if (id != null) 'id': id,
    'vendor_id': vendorId,
    'section_key': name,
    'display_name': englishName,
    if (arabicName != null) 'arabic_name': arabicName,
    'display_type': displayType,
    if (cardWidth != null) 'card_width': cardWidth,
    if (cardHeight != null) 'card_height': cardHeight,
    'items_per_row': itemsPerRow,
    'is_active': isActive,
    'is_visible_to_customers': isVisibleToCustomers,
    'sort_order': sortOrder,
    if (iconName != null) 'icon_name': iconName,
    if (colorHex != null) 'color_hex': colorHex,
    if (createdAt != null) 'created_at': createdAt!.toIso8601String(),
    if (updatedAt != null) 'updated_at': updatedAt!.toIso8601String(),
  };
}
```

---

## ุงูุฎูุงุตุฉ

### ุงูุชุบููุฑุงุช ุงูุฑุฆูุณูุฉ:
- โ **6 ุญููู** โ **17 ุญูู** (ุฒูุงุฏุฉ 11 ุญูู ุฌุฏูุฏ)
- โ **0 Indexes** โ **6 Indexes**
- โ **0 Functions** โ **3 Functions**
- โ **0 Triggers** โ **2 Triggers**
- โ **0 Policies** โ **5 RLS Policies**
- โ ุฅุถุงูุฉ **Trigger ุชููุงุฆู** ูุฅูุดุงุก ุงูุฃูุณุงู ุนูุฏ ุชุณุฌูู ุชุงุฌุฑ ุฌุฏูุฏ

### ุงูููุงุฆุฏ:
1. **ุชุฎุตูุต ูุงูู** ููุฃูุณุงู ููู ุชุงุฌุฑ
2. **ุฃูุงู ูุญุณูู** ูุน RLS Policies
3. **ุฃุฏุงุก ุฃูุถู** ูุน Indexes ูุญุณููุฉ
4. **ุฅูุดุงุก ุชููุงุฆู** ููุฃูุณุงู ุงูุงูุชุฑุงุถูุฉ
5. **ูุฑููุฉ ูู ุงูุนุฑุถ** (5 ุฃููุงุน ูุฎุชููุฉ)

---

**ููุฒูุฏ ูู ุงููุนูููุงุช:**
- ุงูุณูุฑูุจุช ุงููุงูู: `create_vendor_sections_complete_updated.sql`
- ุงูุฏููู ุงูุดุงูู: `VENDOR_SECTIONS_SYSTEM_GUIDE.md`
- ุฏููู ุงูุชุซุจูุช: `SECTIONS_COMPLETE_SETUP_GUIDE.md`

