# 🗺️ دليل دمج خرائط جوجل في تطبيق iStoreto

---

## ✅ الإصلاحات المكتملة

### 1. نظام العناوين ✓
- ✅ **AddressModel** يتطابق 100% مع جدول قاعدة البيانات
- ✅ جميع الأعمدة موجودة ومدعومة
- ✅ **AddressService** يحتوي على جميع الدوال اللازمة
- ✅ تحميل العناوين تلقائياً عند فتح صفحة Checkout
- ✅ اختيار العنوان الافتراضي تلقائياً
- ✅ التحقق من العنوان قبل إتمام الطلب

### 2. الترجمات ✓
- ✅ إضافة جميع مفاتيح الترجمة المفقودة
- ✅ دعم العربية والإنجليزية بالكامل
- ✅ استبدال جميع النصوص الثابتة

---

## 🚀 خطوات دمج Google Maps

### الخطوة 1️⃣: احصل على API Keys

1. اذهب إلى: https://console.cloud.google.com/
2. أنشئ مشروع جديد
3. فعّل هذه الـ APIs:
   - **Maps SDK for Android** ✓
   - **Maps SDK for iOS** ✓
   - **Geocoding API** ✓
   - **Places API** ✓

4. أنشئ API Keys:
   - **مفتاح للأندرويد**: مُقيد بـ Package Name + SHA-1
   - **مفتاح للـ iOS**: مُقيد بـ Bundle Identifier

---

### الخطوة 2️⃣: أضف الحزم

في `pubspec.yaml`:

```yaml
dependencies:
  google_maps_flutter: ^2.5.3
  geolocator: ^11.0.0
  geocoding: ^2.1.1
  permission_handler: ^11.0.1
```

نفذ:
```bash
flutter pub get
```

---

### الخطوة 3️⃣: إعدادات Android

#### `android/app/src/main/AndroidManifest.xml`:

```xml
<manifest>
    <!-- أضف الأذونات -->
    <uses-permission android:name="android.permission.ACCESS_FINE_LOCATION"/>
    <uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION"/>
    
    <application>
        <!-- أضف API Key -->
        <meta-data
            android:name="com.google.android.geo.API_KEY"
            android:value="ضع_مفتاح_الأندرويد_هنا"/>
    </application>
</manifest>
```

#### `android/app/build.gradle`:

```gradle
android {
    defaultConfig {
        minSdkVersion 21  // تأكد أنه 21 أو أعلى
    }
}
```

---

### الخطوة 4️⃣: إعدادات iOS

#### `ios/Runner/AppDelegate.swift`:

```swift
import GoogleMaps

@UIApplicationMain
@objc class AppDelegate: FlutterAppDelegate {
  override func application(...) -> Bool {
    GMSServices.provideAPIKey("ضع_مفتاح_iOS_هنا")
    GeneratedPluginRegistrant.register(with: self)
    return super.application(...)
  }
}
```

#### `ios/Runner/Info.plist`:

```xml
<dict>
    <key>NSLocationWhenInUseUsageDescription</key>
    <string>نحتاج للوصول إلى موقعك لتحديد عنوان التوصيل</string>
    
    <key>io.flutter.embedded_views_preview</key>
    <true/>
</dict>
```

#### `ios/Podfile`:

```ruby
platform :ios, '14.0'
```

نفذ:
```bash
cd ios
pod install
cd ..
```

---

### الخطوة 5️⃣: استخدم الـ Widget الجاهز

الكود موجود في الملف: `GOOGLE_MAPS_INTEGRATION_GUIDE.md`

انسخ `GoogleMapPicker` widget وضعه في:
`lib/featured/payment/widgets/google_map_picker.dart`

---

### الخطوة 6️⃣: أضف زر في صفحة إضافة العنوان

```dart
ElevatedButton.icon(
  onPressed: () {
    Navigator.push(
      context,
      MaterialPageRoute(
        builder: (context) => GoogleMapPicker(
          onLocationSelected: (position, address) {
            // احفظ الإحداثيات
            selectedLatitude = position.latitude;
            selectedLongitude = position.longitude;
            fullAddressController.text = address;
          },
        ),
      ),
    );
  },
  icon: Icon(Icons.map),
  label: Text('اختر من الخريطة'),
)
```

---

## 📋 قائمة المراجعة

### قبل البدء:
- [ ] حصلت على Google Maps API Keys (Android + iOS)
- [ ] قيّدت API Keys بناءً على التطبيق
- [ ] فعّلت الـ APIs المطلوبة

### الإعداد:
- [ ] أضفت الحزم في pubspec.yaml
- [ ] أضفت API Key في AndroidManifest.xml
- [ ] أضفت API Key في AppDelegate.swift
- [ ] حدثت Info.plist بأوصاف الأذونات
- [ ] حدثت minSdkVersion إلى 21
- [ ] حدثت iOS platform إلى 14.0
- [ ] نفذت: `flutter pub get`
- [ ] نفذت: `cd ios && pod install && cd ..`
- [ ] نفذت: `flutter clean`

### الاختبار:
- [ ] جربت التطبيق على Android
- [ ] جربت التطبيق على iOS
- [ ] تحققت من طلب أذونات الموقع
- [ ] تحققت من ظهور الخريطة بشكل صحيح
- [ ] جربت اختيار موقع وحفظه

---

## ⚠️ مشاكل شائعة وحلولها

### المشكلة: الخريطة لا تظهر
**الحل:**
1. تحقق من صحة API Key
2. تأكد من تفعيل Maps SDK
3. راجع Logs: `flutter run -v`

### المشكلة: "Authorization failure"
**الحل:**
1. تحقق من قيود API Key
2. تأكد من Package Name/Bundle ID صحيح
3. أضف SHA-1 fingerprint للأندرويد

### المشكلة: الموقع الحالي لا يعمل
**الحل:**
1. تحقق من الأذونات في الملفات
2. فعّل GPS على الجهاز
3. اختبر على جهاز حقيقي (ليس محاكي)

---

## 🎯 الملخص

### ما تم إنجازه ✅:
1. نظام العناوين يعمل 100% مع قاعدة البيانات
2. التحميل والاختيار التلقائي للعناوين
3. التحقق من العناوين قبل إتمام الطلب
4. جميع الترجمات متوفرة

### ما تحتاج فعله الآن 📝:
1. احصل على Google Maps API Keys
2. أضفها في الملفات المحددة
3. اتبع خطوات الإعداد أعلاه
4. اختبر التطبيق

---

## 📞 للدعم

- راجع الدليل الكامل: `GOOGLE_MAPS_INTEGRATION_GUIDE.md`
- Google Maps Docs: https://pub.dev/packages/google_maps_flutter
- Google Cloud Console: https://console.cloud.google.com/

---

**تاريخ الإنشاء**: أكتوبر 2025
**الحالة**: ✅ جاهز للتطبيق

